name: Publish SDKs

on:
  push:
    tags:
      - 'typescript-v*'
      - 'python-v*'
      - 'go-v*'

jobs:
  publish-typescript:
    if: startsWith(github.ref, 'refs/tags/typescript-v')
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          registry-url: 'https://registry.npmjs.org'
      
      - name: Install dependencies
        run: cd sdk/freeradical-sdk && npm install
      
      - name: Build
        run: cd sdk/freeradical-sdk && npm run build
      
      - name: Publish to npm
        run: cd sdk/freeradical-sdk && npm publish --access public
        env:
          NODE_AUTH_TOKEN: ${{ secrets.NPM_TOKEN }}
      
      - name: Create GitHub Release
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          VERSION=${GITHUB_REF#refs/tags/typescript-v}
          gh release create "$GITHUB_REF" \
            --title "TypeScript SDK v${VERSION}" \
            --notes "**TypeScript/JavaScript SDK Release**
            
            Install: \`npm install @freeradical/sdk\`
            
            See [CHANGELOG](./sdk/freeradical-sdk/CHANGELOG.md) for details."

  publish-python:
    if: startsWith(github.ref, 'refs/tags/python-v')
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      - name: Install build tools
        run: pip install build twine
      
      - name: Build distributions
        run: cd sdks/python && python -m build
      
      - name: Publish to PyPI
        run: cd sdks/python && twine upload dist/*
        env:
          TWINE_USERNAME: __token__
          TWINE_PASSWORD: ${{ secrets.PYPI_TOKEN }}
      
      - name: Create GitHub Release
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          VERSION=${GITHUB_REF#refs/tags/python-v}
          gh release create "$GITHUB_REF" \
            --title "Python SDK v${VERSION}" \
            --notes "**Python SDK Release**
            
            Install: \`pip install freeradical-client\`
            
            See [README](./sdks/python/README.md) for details."

  publish-go:
    if: startsWith(github.ref, 'refs/tags/go-v')
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Setup Go
        uses: actions/setup-go@v5
        with:
          go-version: '1.22'
      
      - name: Run tests
        run: cd sdks/go && go test ./...
      
      - name: Create GitHub Release
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          VERSION=${GITHUB_REF#refs/tags/go-v}
          gh release create "$GITHUB_REF" \
            --title "Go SDK v${VERSION}" \
            --notes "**Go SDK Release**
            
            Install: \`go get github.com/cyberiums/freeradical-go-client@${GITHUB_REF}\`
            
            See [README](./sdks/go/README.md) for details."
